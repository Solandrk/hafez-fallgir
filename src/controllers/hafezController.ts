import { Request, Response } from 'express';
import axios from 'axios';

// Mock dataset if API is unavailable
const poems = [
    {
        "poem": `الا ایها الساقی ادر کاساً و ناولها
که عشق آسان نمود اول ولی افتاد مشکل‌ها
بسیار شد که جنس عمر به سرآمد رسد
ما از آن سال ندیدیم درگذشت خویش را
از آن پس که به چشم خویش نشستم و گفتم
«دگر به گل و بلبلان نخواهم نپرداشد»`,
        "meaning": "ای ساقی، یک جام شراب بیاور و به من بده، زیرا عشق در ابتدا آسان به نظر می‌رسید اما مشکلات فراوانی ایجاد شد. بسیاری از سال‌ها گذشت تا عمر به پایان رسید، اما ما هنوز از آن سال مرگ خود خبر نداریم. از زمانی که به چشمان خود نگاه کردم و گفتم، دیگر نمی‌خواهم با گل و بلبلان ارتباط داشته باشم.",
        "concept": {
            "interpretation": "این غزل بیانگر چالش‌های عشق و گذر زمان است.",
            "life_lesson": "عشق ممکن است در ابتدا آسان به نظر برسد، اما با گذر زمان پیچیدگی‌های خود را نشان می‌دهد."
        },
        "ai_opinion": "بیان زیبای چالش‌های عشق و تغییرات زمان."
    },
    {
        "poem": `دل می‌رود ز دستم صاحب دلان خدا را
در دا که راز پنهان خواهد شد آشکارا
کشتی شکستگانیم ای باد شرطه برخیز
که ایرانی‌ها نیستند دژمنان ما را`,
        "meaning": "دل از دستم می‌رود، ای صاحبان دل، خدا را، افسوس که رازهای پنهان به طور آشکار ظاهر خواهد شد. ما کشتی‌شکسته‌ایم، ای باد، شرطه برخیز؛ زیرا ایرانی‌ها دشمنان ما نیستند.",
        "concept": {
            "interpretation": "این غزل به احساسات از دست رفته و امید به کمک الهی اشاره دارد.",
            "life_lesson": "در لحظات دشوار، امید و اعتماد به خدا می‌تواند تسلی‌بخش باشد."
        },
        "ai_opinion": "نمایش احساس از دست دادن و امید به کمک الهی."
    },
    {
        "poem": `هر آنکه از تو مست وشیرین‌ترم نیاید
چون به راه من آید هوس گل می‌برد
درخت دوستی بنشان که کام دل به بار آید
نهال مستی سرهنگ را از دیده برد`,
        "meaning": "هر کسی که از تو مست و شیرین‌تر نیست، وقتی به راه من می‌آید، هوس گل را می‌برد. درخت دوستی بنشان تا دل به کام برسد، و نهال مستی سرباز را از دید دور کند.",
        "concept": {
            "interpretation": "این غزل به اهمیت دوستی و ایجاد روابط دوستانه اشاره دارد.",
            "life_lesson": "دوستی و روابط خوب می‌توانند مشکلات و دشواری‌های زندگی را کاهش دهند."
        },
        "ai_opinion": "تاکید بر ارزش دوستی و تاثیر آن بر زندگی."
    },
    {
        "poem": `درخت دوستی بنشان که کام دل به بار آید
نهال مستی سرهنگ را از دیده برد
سر زلف تو بردارم و به جام گل بنشانم
که بنشاند شراب ساقی عاقبت برد`,
        "meaning": "درخت دوستی بنشان تا دل به کام برسد و نهال مستی سرباز را از دید دور کند. سر زلف تو را بردارم و در جام گل بنشانم، تا ساقی شراب بیاورد و نتیجه‌ای مطلوب حاصل شود.",
        "concept": {
            "interpretation": "این غزل به ایجاد روابط دوستانه و استفاده از زیبایی‌های عشق اشاره دارد.",
            "life_lesson": "روابط دوستانه و زیبایی عشق می‌توانند زندگی را شیرین‌تر و آرام‌تر کنند."
        },
        "ai_opinion": "ترکیب دوستی و عشق برای زندگی بهتر."
    },
    {
        "poem": `گفتم غمت شیرین است و شیرین‌ترم
گفتا غمت شیرین است و شیرین‌ترم
دل من ز تو چون ز جگر پر خال شود
پرده‌گشایی بجویم و باز تو را`,
        "meaning": "گفتم که غم تو شیرین است و من نیز شیرین‌ترم. او پاسخ داد که غم تو شیرین است و من نیز شیرین‌ترم. دل من از تو مانند جگر پر خال می‌شود، بنابراین پرده‌گشایی را بجوییم و تو را دوباره ببینیم.",
        "concept": {
            "interpretation": "این غزل به تبادل احساسات و عشق عمیق اشاره دارد.",
            "life_lesson": "تبادل احساسات می‌تواند به تعمیق روابط و فهم بهتر یکدیگر منجر شود."
        },
        "ai_opinion": "تبادل احساسات و عمق عشق در روابط."
    },
    {
        "poem": `آن غزالان آن خالان آن نیگونان من
که در دیده‌ام جای برپایند و جای من
زان مرغ بی‌قرار که در باغ خوش است
کیان دل به کعبه‌ی تو راه دارد`,
        "meaning": "آن غزالان، آن خالان، آن نیگونان من که در چشم‌هایم جای گرفته‌اند و جا دارند. آن مرغ بی‌قراری که در باغ خوش است، چگونه دل به کعبه‌ی تو راه دارد.",
        "concept": {
            "interpretation": "این غزل به زیبایی‌های طبیعت و تاثیر آن بر احساسات اشاره دارد.",
            "life_lesson": "زیبایی‌های اطراف می‌توانند الهام‌بخش و تاثیرگذار بر روح و روان ما باشند."
        },
        "ai_opinion": "زیبایی طبیعت و تاثیر آن بر دل انسان."
    },
    {
        "poem": `بنی آدم اعضای یک پیکرند
که در آفرینش ز یک گوهرند
چو عضوی به درد آید، دیگر عضوها را
نبینند ز درد، دردگران هر یک`,
        "meaning": "بنی آدم اعضای یک پیکرند که در آفرینش از یک گوهرند. هنگامی که یکی از اعضا درد می‌کشد، دیگر اعضا نیز از درد آن بی‌خبر نیستند.",
        "concept": {
            "interpretation": "این غزل به همبستگی انسانی و اهمیت همکاری و همدلی اشاره دارد.",
            "life_lesson": "همدلی و همکاری با دیگران می‌تواند به بهبود جامعه و کاهش درد و رنج کمک کند."
        },
        "ai_opinion": "اهمیت همبستگی و همدلی در جامعه."
    },
    {
        "poem": `همه عالم اوست و من جز او نیستم
عشق او را هر که دارد دوست دارد
در این جهان همه چیز فناپذیر است
جز عشق و یاد او که همیشگی‌ست`,
        "meaning": "تمام عالم از آن اوست و من جز او نیستم. هر که عشق او را دارد، دوستش دارد. در این جهان همه چیز فناپذیر است، جز عشق و یاد او که همیشگی است.",
        "concept": {
            "interpretation": "این غزل به وحدت با معشوق و پایایی عشق اشاره دارد.",
            "life_lesson": "عشق واقعی و یاد معشوق پایدارتر از مادیات و دنیا است."
        },
        "ai_opinion": "پایایی عشق در مقابل فناپذیری دنیا."
    },
    {
        "poem": `چون آمد و بازگو شد زمان و مکان
دل بر افروخت و جان ز جانان شد
هر کسی از این دیار رهی به گوش دارد
به کجا کنم چو همه بر سر من آمد`,
        "meaning": "زمان و مکان وقتی آمد و بازگو شد، دل به آتش کشید و جان از جانان شد. هر کسی در این دیار راهی به گوش دارد، اما من چگونه عمل کنم وقتی همه به سر من آمده‌اند.",
        "concept": {
            "interpretation": "این غزل به تغییرات ناگهانی و تأثیر آن‌ها بر احساسات انسان اشاره دارد.",
            "life_lesson": "تغییرات می‌توانند احساسات و زندگی ما را به سرعت تغییر دهند؛ باید آماده‌ی مواجهه با آن‌ها باشیم."
        },
        "ai_opinion": "تأثیر تغییرات ناگهانی بر احساسات انسان."
    },
    {
        "poem": `این همه سخن هیچ کس نگفت
که حرف‌های تو ندارم به بقا
اگر تو ز توانا در کار هستی
این دنیا راه نیست برای خدا`,
        "meaning": "این همه سخن هیچ‌کس نگفت که حرف‌های تو را ندارم برای باقی ماندن. اگر تو از توانا در کار هستی، این دنیا راه نیست برای خدا.",
        "concept": {
            "interpretation": "این غزل به اهمیت کلام و تأثیر آن بر زندگی اشاره دارد.",
            "life_lesson": "کلام و ارتباطات ما تأثیر زیادی بر روابط و بقا در زندگی دارند."
        },
        "ai_opinion": "اهمیت کلام و ارتباطات در زندگی روزمره."
    },
    {
        "poem": `ای ساقی! باده بده که دل پر ز عشق شود
در این دل پر از آتش توست`,
        "meaning": "ای ساقی! شراب بده تا دل پر از عشق شود زیرا در این دل آتش توست.",
        "concept": {
            "interpretation": "این غزل به شدت عشق و اشتیاق فرد نسبت به معشوق اشاره دارد.",
            "life_lesson": "عشق می‌تواند انگیزه‌ای قوی برای زندگی و دستیابی به اهداف باشد."
        },
        "ai_opinion": "بیان شدیدی از عشق و اشتیاق."
    },
    {
        "poem": `گفتم که دل به یار ندیدم که آرامش یابد
گفتا که عشق تو همواره پر از اشک است`,
        "meaning": "گفتم که دل به یار ندیدم که آرامش یابد، او گفت که عشق تو همواره پر از اشک است.",
        "concept": {
            "interpretation": "این غزل به چالش‌های عشق و احساسات پیچیده اشاره دارد.",
            "life_lesson": "عشق ممکن است با دشواری‌ها و اشک‌ها همراه باشد، اما ارزشمند است."
        },
        "ai_opinion": "تأملی زیبا بر چالش‌های عشق."
    },
    {
        "poem": `ای ساقی! می ده که دل آرام گیرد
که در این دل پر از خیال تو زنده‌ام`,
        "meaning": "ای ساقی! شراب بده تا دل آرام گیرد زیرا در این دل پر از خیال تو زنده‌ام.",
        "concept": {
            "interpretation": "این غزل به نیاز دل برای آرامش و سکون اشاره دارد.",
            "life_lesson": "آرامش درونی می‌تواند به تعادل و سلامت روحی کمک کند."
        },
        "ai_opinion": "درخواست آرامش و سکون دل."
    },
    {
        "poem": `بنی آدم اعضای یک پیکرند
که در آفرینش ز یک گوهرند
چو عضوی به درد آید، دیگر عضوها را
نبینند ز درد، دردگران هر یک`,
        "meaning": "بنی آدم اعضای یک پیکرند که در آفرینش از یک گوهرند. هنگامی که یکی از اعضا درد می‌کشد، دیگر اعضا نیز از درد آن بی‌خبر نیستند.",
        "concept": {
            "interpretation": "این غزل به همبستگی انسانی و اهمیت همکاری و همدلی اشاره دارد.",
            "life_lesson": "همدلی و همکاری با دیگران می‌تواند به بهبود جامعه و کاهش درد و رنج کمک کند."
        },
        "ai_opinion": "اهمیت همبستگی و همدلی در جامعه."
    },
    {
        "poem": `همه عالم اوست و من جز او نیستم
عشق او را هر که دارد دوست دارد
در این جهان همه چیز فناپذیر است
جز عشق و یاد او که همیشگی‌ست`,
        "meaning": "تمام عالم از آن اوست و من جز او نیستم. هر که عشق او را دارد، دوستش دارد. در این جهان همه چیز فناپذیر است، جز عشق و یاد او که همیشگی است.",
        "concept": {
            "interpretation": "این غزل به وحدت با معشوق و پایایی عشق اشاره دارد.",
            "life_lesson": "عشق واقعی و یاد معشوق پایدارتر از مادیات و دنیا است."
        },
        "ai_opinion": "پایایی عشق در مقابل فناپذیری دنیا."
    },
    {
        "poem": `چون آمد و بازگو شد زمان و مکان
دل بر افروخت و جان ز جانان شد
هر کسی از این دیار رهی به گوش دارد
به کجا کنم چو همه بر سر من آمد`,
        "meaning": "زمان و مکان وقتی آمد و بازگو شد، دل به آتش کشید و جان از جانان شد. هر کسی در این دیار راهی به گوش دارد، اما من چگونه عمل کنم وقتی همه به سر من آمده‌اند.",
        "concept": {
            "interpretation": "این غزل به تغییرات ناگهانی و تأثیر آن‌ها بر احساسات انسان اشاره دارد.",
            "life_lesson": "تغییرات می‌توانند احساسات و زندگی ما را به سرعت تغییر دهند؛ باید آماده‌ی مواجهه با آن‌ها باشیم."
        },
        "ai_opinion": "تأثیر تغییرات ناگهانی بر احساسات انسان."
    },
    {
        "poem": `این همه سخن هیچ کس نگفت
که حرف‌های تو ندارم به بقا
اگر تو ز توانا در کار هستی
این دنیا راه نیست برای خدا`,
        "meaning": "این همه سخن هیچ‌کس نگفت که حرف‌های تو را ندارم برای باقی ماندن. اگر تو از توانا در کار هستی، این دنیا راه نیست برای خدا.",
        "concept": {
            "interpretation": "این غزل به اهمیت کلام و تأثیر آن بر زندگی اشاره دارد.",
            "life_lesson": "کلام و ارتباطات ما تأثیر زیادی بر روابط و بقا در زندگی دارند."
        },
        "ai_opinion": "اهمیت کلام و ارتباطات در زندگی روزمره."
    },
    {
        "poem": `الا ایها الساقی ادر کاساً و ناولها
که عشق آسان نمود اول ولی افتاد مشکل‌ها
بسیار شد که جنس عمر به سرآمد رسد
ما از آن سال ندیدیم درگذشت خویش را
از آن پس که به چشم خویش نشستم و گفتم
«دگر به گل و بلبلان نخواهم نپرداشد»`,
        "meaning": "ای ساقی، یک جام شراب بیاور و به من بده، زیرا عشق در ابتدا آسان به نظر می‌رسید اما مشکلات فراوانی ایجاد شد. بسیاری از سال‌ها گذشت تا عمر به پایان رسید، اما ما هنوز از آن سال مرگ خود خبر نداریم. از زمانی که به چشمان خود نگاه کردم و گفتم، دیگر نمی‌خواهم با گل و بلبلان ارتباط داشته باشم.",
        "concept": {
            "interpretation": "این غزل بیانگر چالش‌های عشق و گذر زمان است.",
            "life_lesson": "عشق ممکن است در ابتدا آسان به نظر برسد، اما با گذر زمان پیچیدگی‌های خود را نشان می‌دهد."
        },
        "ai_opinion": "بیان زیبای چالش‌های عشق و تغییرات زمان."
    },
    {
        "poem": `دل می‌رود ز دستم صاحب دلان خدا را
در دا که راز پنهان خواهد شد آشکارا
کشتی شکستگانیم ای باد شرطه برخیز
که ایرانی‌ها نیستند دژمنان ما را`,
        "meaning": "دل از دستم می‌رود، ای صاحبان دل، خدا را، افسوس که رازهای پنهان به طور آشکار ظاهر خواهد شد. ما کشتی‌شکسته‌ایم، ای باد، شرطه برخیز؛ زیرا ایرانی‌ها دشمنان ما نیستند.",
        "concept": {
            "interpretation": "این غزل به احساسات از دست رفته و امید به کمک الهی اشاره دارد.",
            "life_lesson": "در لحظات دشوار، امید و اعتماد به خدا می‌تواند تسلی‌بخش باشد."
        },
        "ai_opinion": "نمایش احساس از دست دادن و امید به کمک الهی."
    },
    {
        "poem": `هر آنکه از تو مست وشیرین‌ترم نیاید
چون به راه من آید هوس گل می‌برد
درخت دوستی بنشان که کام دل به بار آید
نهال مستی سرهنگ را از دیده برد`,
        "meaning": "هر کسی که از تو مست و شیرین‌تر نیست، وقتی به راه من می‌آید، هوس گل را می‌برد. درخت دوستی بنشان تا دل به کام برسد، و نهال مستی سرباز را از دید دور کند.",
        "concept": {
            "interpretation": "این غزل به اهمیت دوستی و ایجاد روابط دوستانه اشاره دارد.",
            "life_lesson": "دوستی و روابط خوب می‌توانند مشکلات و دشواری‌های زندگی را کاهش دهند."
        },
        "ai_opinion": "تاکید بر ارزش دوستی و تاثیر آن بر زندگی."
    },
    {
        "poem": `ای ساقی! به جامم شراب تو بده
که دل پر از عشق و جان پر از توست
هر لحظه به یاد تو دل پر غم است
که در این دل پر از غمت زنده‌ام`,
        "meaning": "ای ساقی! به جامم شراب تو بده زیرا دلم پر از عشق و جانم پر از توست. هر لحظه به یاد تو دلم پر از غم است زیرا در این دل پر از غمت زنده‌ام.",
        "concept": {
            "interpretation": "این غزل به شدت عشق و اشتیاق برای آرامش از طریق شراب اشاره دارد.",
            "life_lesson": "عشق می‌تواند هم شورانگیز و هم نیازمند آرامش باشد."
        },
        "ai_opinion": "ترکیب عشق عمیق با نیاز به آرامش."
    },
    {
        "poem": `در این شب تار، دل پر از غم است
هر لحظه به یاد تو دل تنگ است
ای ساقی! می ده که دل آرام گیرد
که در این دل پر از غمت زنده‌ام`,
        "meaning": "در این شب تاریک، دلم پر از غم است و هر لحظه به یاد تو دلم تنگ است. ای ساقی! می بده تا دل آرام گیرد زیرا در این دل پر از غمت زنده‌ام.",
        "concept": {
            "interpretation": "این غزل به غم و تنگی دل در عشق اشاره دارد.",
            "life_lesson": "عشق می‌تواند باعث غم و تنگی دل شود، اما یافتن آرامش اهمیت دارد."
        },
        "ai_opinion": "بیان غم و تنگی دل در عشق."
    },
    {
        "poem": `گلستان دل من پر از عشق توست
هر گوشه‌اش پر از یاد توست
ای ساقی! می ده که دل آرام گیرد
که در این دل پر از غمت زنده‌ام`,
        "meaning": "باغ دل من پر از عشق توست و هر گوشه آن پر از یاد توست. ای ساقی! می بده تا دل آرام گیرد زیرا در این دل پر از غمت زنده‌ام.",
        "concept": {
            "interpretation": "این غزل به زیبایی عشق و حضور معشوق در دل اشاره دارد.",
            "life_lesson": "عشق می‌تواند دل را پر از زیبایی و یاد معشوق کند."
        },
        "ai_opinion": "تأکید بر زیبایی و حضور معشوق در دل."
    },
    {
        "poem": `ای ساقی! به جامم شراب تو بده
که دل پر از عشق و جان پر از توست
هر لحظه به یاد تو دل پر غم است
که در این دل پر از غمت زنده‌ام`,
        "meaning": "ای ساقی! به جامم شراب تو بده زیرا دلم پر از عشق و جانم پر از توست. هر لحظه به یاد تو دلم پر از غم است زیرا در این دل پر از غمت زنده‌ام.",
        "concept": {
            "interpretation": "این غزل به شدت عشق و اشتیاق برای آرامش از طریق شراب اشاره دارد.",
            "life_lesson": "عشق می‌تواند هم شورانگیز و هم نیازمند آرامش باشد."
        },
        "ai_opinion": "ترکیب عشق عمیق با نیاز به آرامش."
    },
    {
        "poem": `ای ساقی! می ده که دل پر آرام شود
در این دل پر از عشق تو زنده‌ام`,
        "meaning": "ای ساقی! می بده تا دل پر آرام شود زیرا در این دل پر از عشق تو زنده‌ام.",
        "concept": {
            "interpretation": "این غزل به نیاز دل برای آرامش و سکون اشاره دارد.",
            "life_lesson": "آرامش درونی می‌تواند به تعادل و سلامت روحی کمک کند."
        },
        "ai_opinion": "درخواست آرامش و سکون دل."
    },
    {
        "poem": `ای ساقی! می ده که دل پر آرام گیرد
که در این دل پر از غم تو زنده‌ام`,
        "meaning": "ای ساقی! می بده تا دل آرام گیرد زیرا در این دل پر از غمت زنده‌ام.",
        "concept": {
            "interpretation": "این غزل به نیاز دل برای آرامش و سکون اشاره دارد.",
            "life_lesson": "آرامش درونی می‌تواند به تعادل و سلامت روحی کمک کند."
        },
        "ai_opinion": "درخواست آرامش و سکون دل."
    },
    {
        "poem": `ای ساقی! می ده که دل پر آرام شود
که در این دل پر از عشق تو زنده‌ام`,
        "meaning": "ای ساقی! می بده تا دل پر آرام شود زیرا در این دل پر از عشق تو زنده‌ام.",
        "concept": {
            "interpretation": "این غزل به نیاز دل برای آرامش و سکون اشاره دارد.",
            "life_lesson": "آرامش درونی می‌تواند به تعادل و سلامت روحی کمک کند."
        },
        "ai_opinion": "درخواست آرامش و سکون دل."
    },
    {
        "poem": `ای ساقی! می ده که دل پر آرام گیرد
که در این دل پر از غمت زنده‌ام`,
        "meaning": "ای ساقی! می بده تا دل آرام گیرد زیرا در این دل پر از غمت زنده‌ام.",
        "concept": {
            "interpretation": "این غزل به نیاز دل برای آرامش و سکون اشاره دارد.",
            "life_lesson": "آرامش درونی می‌تواند به تعادل و سلامت روحی کمک کند."
        },
        "ai_opinion": "درخواست آرامش و سکون دل."
    },
    {
        "poem": `ای ساقی! می ده که دل پر آرام شود
که در این دل پر از عشق تو زنده‌ام`,
        "meaning": "ای ساقی! می بده تا دل پر آرام شود زیرا در این دل پر از عشق تو زنده‌ام.",
        "concept": {
            "interpretation": "این غزل به نیاز دل برای آرامش و سکون اشاره دارد.",
            "life_lesson": "آرامش درونی می‌تواند به تعادل و سلامت روحی کمک کند."
        },
        "ai_opinion": "درخواست آرامش و سکون دل."
    }
]



export const getFalPage = (req: Request, res: Response) => {
    res.render('index', { poem: null, message: null });
};

export const getRandomFal = async (req: Request, res: Response) => {
    try {
        // If API available, fetch data from API
        // const response = await axios.get('https://hafezapi.example.com/random');
        // const poem = response.data.poem;

        // Fallback to mock dataset
        const poem = poems[Math.floor(Math.random() * poems.length)];
        res.render('index', { poem, message: null });
    } catch (error) {
        res.render('index', { poem: null, message: 'خطایی رخ داده است. لطفا دوباره تلاش کنید.' });
    }
};
